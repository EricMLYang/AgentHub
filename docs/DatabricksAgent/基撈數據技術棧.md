下面用「**最簡單：規劃 > 撈數據**」的角度，告訴你在 Databricks 上怎麼把 **LangChain** 跟 **Mosaic AI / Vector Search / Unity Catalog Function / Function Calling** 串起來（先做 MVP，再逐步加能力）。

---

## 你要的 MVP 架構（最少元件就能跑）

**目標：** LLM 先「規劃」，再「呼叫一個工具」去 Databricks 撈資料（SQL / Delta table），最後把結果整理成回答。

**最小組合：**

1. **LangChain**：負責對話流程（prompt / chain / agent）
2. **Databricks-served LLM**（Mosaic AI Model Serving / Foundation Model API）：當你的 LLM 來源（在 Databricks 內可治理、可部署成 API） ([docs.databricks.com][1])
3. **Unity Catalog Function（UC Function）**：把「撈數據」包成一個可控、可稽核、可授權的工具（Tool）給 LLM 呼叫 ([docs.databricks.com][2])
4. （可選，但很順）**Function Calling**：讓 LLM 用「工具呼叫」的方式自動決定何時要撈數據（OpenAI-compatible 風格） ([docs.databricks.com][3])

> 先用 UC Function 做「撈數據」工具，你就能把 Agent 的能力**鎖在你允許的範圍**：LLM 不能亂查、不能亂碰不該碰的表，權限/血緣/稽核都走 Unity Catalog。

---

## Step-by-step：照這個做就能跑

### Step 1｜先把「撈數據」做成 UC Function（你先控制入口）

你先選一個最常用的查詢，做成像這樣的「資料 API」概念：

* `get_sales_summary(start_date, end_date, store_id)`
* `get_device_status(site_id)`
* `get_ad_play_log(date, screen_id)`

Databricks 的 Agent Framework 文件就是把 **UC functions 當作 agent tools** 的標準做法（而且有 Runtime 版本需求，例如 DBR 15+）([docs.databricks.com][2])

### Step 2｜在 Databricks 用 LangChain 連到「Databricks-served LLM」

Databricks 官方有「LangChain on Databricks」整合：你可以把 Databricks 服務化的模型當成 LangChain 的 LLM / embeddings 來源 ([docs.databricks.com][4])

### Step 3｜把 UC Function 當成 LangChain Tool（或讓模型用 Function Calling）

這裡有兩種簡單路線，你先選最直覺的：

**路線 A（最直覺、最穩）**：
你在 LangChain 寫死流程：
「先叫 LLM 產生 plan → 再固定呼叫 `get_sales_summary()` → 再叫 LLM 彙整」

**路線 B（更像 Agent）**：
用 Databricks 的 **Function Calling**，讓 LLM 在對話中自己判斷何時要呼叫 `get_sales_summary()` ([docs.databricks.com][3])

> 你如果要「規劃 > 撈數據」這種兩步，其實路線 A 就很好用了：可控、好除錯、不容易失控。

### Step 4｜（可選）用 AI Playground 先「試跑」你的 tool-calling 行為

Databricks 有 AI Playground 可以快速原型化：指定 UC Function、Vector Search、甚至 MCP，先看 agent 表現再匯出成 Python ([docs.databricks.com][5])

---

## 什麼時候用 Vector Search？（先別急，給你最清楚的判斷）

你現在的需求是「撈數據」（多半是結構化資料：Delta table / SQL）。那 **UC Function = 第一優先**。

**Vector Search 什麼時候上？**
當你要撈的是「文件、規格、SOP、維運紀錄、issue、會議記錄」這種**非結構化文字**，才用 RAG / Vector Search。

而 Databricks 的 **Mosaic AI Vector Search**：通常是從 **Delta table 建 index**、由 Unity Catalog 治理，並提供 ANN similarity search ([docs.databricks.com][6])
LangChain 也有 Databricks Vector Search 的整合頁（範例通常就是：delta table → index → retriever → chain）([LangChain Docs][7])

---

## 你可以直接照抄的「最小流程」長相（概念版）

（這是「路線 A」的穩定 MVP）

```text
User 問題
  ↓
LLM(規劃): 輸出 Plan（要查哪個時間範圍 / 哪個門店 / 哪個指標）
  ↓
Tool(UC Function): get_sales_summary(start_date, end_date, store_id)
  ↓
LLM(整理): 根據查回結果做摘要、解釋、下一步建議
---
